CREATE PROCEDURE USP_OBTER_PARTIDAS
@ID_FASE INT 
AS
SELECT a.ID_PARTIDA, a.DT_PARTIDA, a.DS_PARTIDA, p1.ID_PLACAR ID_SELECAO_1, p2.ID_PLACAR  ID_SELECAO_2, 
s1.DS_SELECAO + ' ' + CONVERT(VARCHAR(50), p1.NR_GOL + ISNULL(p1.NR_GOL_PRORROGACAO, 0)) 
+ CASE p1.NR_GOL_DECISAO_PENALTIS WHEN 0 THEN '' ELSE '(' + CONVERT(VARCHAR(50), p1.NR_GOL_DECISAO_PENALTIS) + ')' END
+ ' X ' 
+ CASE p2.NR_GOL_DECISAO_PENALTIS WHEN 0 THEN '' ELSE '(' + CONVERT(VARCHAR(50), p2.NR_GOL_DECISAO_PENALTIS) + ')' END
+  CONVERT(VARCHAR(50), p2.NR_GOL + ISNULL(p2.NR_GOL_PRORROGACAO, 0)) + ' ' + s2.DS_SELECAO DS_PLACAR,
f.DS_FASE, g1.DS_GRUPO GRUPO_SELECAO_1, g2.DS_GRUPO GRUPO_SELECAO_2,
s1.DS_IMAGEM_BANDEIRA BANDEIRA_1, s1.DS_TIPO_IMAGEM_BANDEIRA TIPO_IMAGEM_BANDEIRA_1, s1.DS_CAMINHO_IMAGEM_BANDEIRA CAMINHO_IMAGEM_BANDEIRA_1,
s2.DS_IMAGEM_BANDEIRA BANDEIRA_2, s2.DS_TIPO_IMAGEM_BANDEIRA TIPO_IMAGEM_BANDEIRA_2, s2.DS_CAMINHO_IMAGEM_BANDEIRA CAMINHO_IMAGEM_BANDEIRA_2,
e.DS_ESTADIO, e.DS_CIDADE, e.DS_CAPACIDADE, e.DS_IMAGEM_ESTADIO, e.DS_TIPO_IMAGEM_ESTADIO, e.DS_CAMINHO_IMAGEM_ESTADIO
FROM TB_PARTIDA a 
INNER JOIN TB_PLACAR p1 ON a.ID_PARTIDA = p1.ID_PARTIDA_PLACAR AND p1.BL_MANDANTE = 1
INNER JOIN TB_PLACAR p2 ON a.ID_PARTIDA = p2.ID_PARTIDA_PLACAR AND p2.BL_MANDANTE = 0
INNER JOIN TB_SELECAO s1 ON p1.ID_SELECAO = s1.ID_SELECAO
INNER JOIN TB_SELECAO s2 ON p2.ID_SELECAO = s2.ID_SELECAO
INNER JOIN TB_FASE f ON a.ID_FASE_PARTIDA = f.ID_FASE
INNER JOIN TB_ESTADIO e ON a.ID_ESTADIO_PARTIDA = e.ID_ESTADIO
INNER JOIN TB_GRUPO g1 ON s1.ID_GRUPO_SELECAO = g1.ID_GRUPO
INNER JOIN TB_GRUPO g2 ON s2.ID_GRUPO_SELECAO = g2.ID_GRUPO
WHERE a.ID_FASE_PARTIDA = @ID_FASE OR @ID_FASE IS NULL



SELECT a.DS_NOME, a.NR_NUMERO, c.DS_POSICAO, b.DS_SELECAO,
a.DS_IMAGEM_JOGADOR, b.DS_IMAGEM_BANDEIRA, d.DS_GRUPO
FROM TB_JOGADOR a
INNER JOIN TB_SELECAO b ON a.ID_SELECAO_JOGADOR = b.ID_SELECAO
INNER JOIN TB_POSICAO c ON a.ID_POSICAO_JOGADOR = c.ID_POSICAO
INNER JOIN TB_GRUPO d ON b.ID_GRUPO_SELECAO = d.ID_GRUPO 